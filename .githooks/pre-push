#!/bin/sh

echo "ğŸ” Running pre-push checks..."

# ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®@pre-pushãƒã‚§ãƒƒã‚¯
echo "ğŸ“ Checking @pre-push tag..."
commit_message=$(git log -1 --pretty=%B)
if ! echo "$commit_message" | grep -q "@pre-push"; then
    echo "âŒ Error: Commit message must include @pre-push tag"
    exit 1
fi
echo "âœ… @pre-push tag check passed"

# Lintãƒã‚§ãƒƒã‚¯
echo "ğŸ§¹ Running linter checks..."

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
echo "ğŸ“ Verifying formatting..."
if ! deno fmt --check; then
    echo "âŒ Format check failed"
    exit 1
fi
echo "âœ… Format check passed"

# Lintãƒã‚§ãƒƒã‚¯
echo "ğŸ” Running linter..."
if ! deno lint; then
    echo "âŒ Lint check failed"
    exit 1
fi
echo "âœ… Lint check passed"

# ãƒ“ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
echo "ğŸ—ï¸ Running build check..."
if ! deno task build; then
    echo "âŒ Build failed"
    exit 1
fi
echo "âœ… Build check passed"

echo "âœ… All checks passed! Ready to push."